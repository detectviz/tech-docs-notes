---
id: migrate-9_x-to-10_x
title: 9.x 至 10.x
sidebar_position: 5
description: 如何將插件從 Grafana 9.x 版遷移至 10.x 版。
keywords:
  - grafana
  - plugins
  - plugin
  - upgrading
  - updating
  - migration
---

import MigrateToReactRouterV6 from '../../shared/_migrate-to-react-router-v6.mdx';

# 將插件從 Grafana 9.x 版遷移至 10.x 版

請遵循以下說明，將插件從 Grafana 9.x 版遷移至 10.x 版。

## 使用 React 18 驗證插件行為

Grafana 10 包含了我們對 React 18 的升級以及對新的 React 用戶端呈現 API 的使用。這些變更已透過 [PR 64428](https://github.com/grafana/grafana/pull/64428) 提交至核心 `grafana` 儲存庫。

雖然這些更新帶來了許多顯著的好處，但它們可能會影響您插件的運作方式。特別是，圍繞改善與 `useEffect` 時間和狀態更新自動批次處理的一致性的變更可能會產生非預期的副作用。

**建議措施：**

- 檢閱 React 18 的[升級文件](https://react.dev/blog/2022/03/08/react-18-upgrade-guide)。
- 針對最新的 [grafana-dev docker 映像檔](https://hub.docker.com/r/grafana/grafana-dev/tags?page=1)（例如，[這個](https://hub.docker.com/layers/grafana/grafana-dev/10.0.0-111404pre/images/sha256-ac78acf54b44bd2ce7e68b796b1df47030da7f35e53b02bc3eec3f4de05f780f?context=explore)）測試您的插件。
- 如果您的插件受到影響，請在[論壇討論](https://community.grafana.com/t/grafana-10-is-upgrading-to-react-18/86051)中新增評論。請務必與我們溝通，以便我們了解問題並提供協助。

## 資料框架欄位值現在只是陣列

在 Grafana 10 中，資料框架中的值現在作為簡單的 JavaScript 陣列進行管理（請參閱 [PR #66480](https://github.com/grafana/grafana/issues/66480)）。不再需要將值包裝在 [`Vector<T>`](https://github.com/grafana/grafana/blob/v9.5.x/packages/grafana-data/src/types/vector.ts) 實作中。

大多數針對 9.x 的程式碼將繼續正常運作，不會有任何問題。一個例外是現有程式碼直接實作 [`Vector<T>`](https://github.com/grafana/grafana/blob/v9.5.x/packages/grafana-data/src/types/vector.ts) 而不是擴充或使用基底類別的罕見情況。在這種情況下，程式碼應傳回一個陣列或擴充 [`FunctionalVector<T>`](https://github.com/grafana/grafana/blob/v10.0.x/packages/grafana-data/src/vector/FunctionalVector.ts#L9)。所有 Vector 實作都已被棄用，並將在未來移除。

在撰寫應在 9.x 上執行的插件時，請繼續使用 Vector 介面。在這種情況下，當針對 10+ 版本時，您現在可以使用簡單的陣列而不是包裝類別。

為了讓此轉換無縫進行，我們使用了原始的 JavaScript Sin™。也就是說，我們[擴充了原生的 Array 原型](https://github.com/grafana/grafana/blob/v10.0.x/packages/grafana-data/src/types/vector.ts)並新增了幾個 Vector 方法。

<MigrateToReactRouterV6 />