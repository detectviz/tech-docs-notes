# 架構概覽

![Argo CD 架構](../assets/argocd_architecture.png)

## 元件

### API 伺服器
API 伺服器是一個 gRPC/REST 伺服器，它公開了供 Web UI、CLI 和 CI/CD
系統使用的 API。它具有以下職責：

*   應用程式管理和狀態報告
*   叫用應用程式操作（例如同步、回滾、使用者定義的操作）
*   儲存庫和叢集憑證管理（儲存為 K8s secret）
*   向外部身份提供者進行身份驗證和授權委派
*   RBAC 強制執行
*   Git webhook 事件的監聽器/轉發器

### 儲存庫伺服器
儲存庫伺服器是一個內部服務，它維護著保存應用程式清單的 Git 儲存庫的
本地快取。當提供以下輸入時，它負責產生並回傳 Kubernetes
清單：

*   儲存庫 URL
*   修訂版本（提交、標籤、分支）
*   應用程式路徑
*   範本特定設定：參數、helm values.yaml

### 應用程式控制器
應用程式控制器是一個 Kubernetes 控制器，它會持續監控正在執行的
應用程式，並將目前的即時狀態與期望的目標狀態（如 repo 中所指定）
進行比較。它會偵測 `OutOfSync` 的應用程式狀態，並可選地採取糾正措施。它
負責叫用任何使用者定義的生命週期事件掛鉤（PreSync、Sync、PostSync）
