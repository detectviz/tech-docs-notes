# 追蹤與部署策略

Argo CD 應用程式規格提供了幾種不同的方式來追蹤 Kubernetes 資源資訊清單。

在所有追蹤策略中，應用程式都可以選擇自動同步。如果設定了[自動同步](auto_sync.md)，新的資源資訊清單將在偵測到差異時立即自動套用。

> [!NOTE]
> 在所有追蹤策略中，任何[參數覆寫](parameters.md)都優先於 Git 狀態。

## Helm

Helm 圖表版本是[語意化版本](https://semver.org/)。因此，您可以使用以下任何版本範圍：

| 使用案例 | 方法 | 範例 |
|-|-|-|
| 釘選至版本（例如在生產環境中） | 使用版本號碼 | `1.2.0` |
| 追蹤修補程式（例如在預先生產環境中） | 使用範圍 | `1.2.*` 或 `>=1.2.0 <1.3.0` |
| 追蹤次要版本（例如在 QA 環境中） | 使用範圍 | `1.*` 或 `>=1.0.0 <2.0.0` |
| 使用最新版本（例如在本機開發中） | 使用星號範圍 | `*` 或 `>=0.0.0` |
| 使用最新版本，包括預先發行版 | 使用帶有 `-0` 後綴的星號範圍 | `*-0` 或 `>=0.0.0-0` |

[閱讀有關版本範圍的資訊](https://www.telerik.com/blogs/the-mystical-magical-semver-ranges-used-by-npm-bower)

> [!NOTE]
> 如果您希望 Argo CD 在比較邏輯中包含儲存庫的所有現有預先發行版本標籤，則必須明確地將預先發行 `-0` 後綴新增到版本限制中。如前所述，`*-0` 會與儲存庫中的預先發行版本進行比較，而 `*` 則不會。這也適用於其他限制，例如 `>=1.2.2` **不會**比較預先發行版本，而 `>=1.2.2-0` 則會在比較中包含預先發行版本。

[閱讀有關預先發行版本比較的資訊](https://github.com/Masterminds/semver?tab=readme-ov-file#working-with-prerelease-versions)

## Git

對於 Git，所有版本都是 Git 參考，但也可以使用[語意化版本](https://semver.org/)標籤：

| 使用案例 | 方法 | 備註 |
|-|-|-|
| 釘選至版本（例如在生產環境中） | (a) 使用（例如 `v1.2.0`）標記提交並使用該標籤，或 (b) 使用提交 SHA。 | 請參閱[提交釘選](#commit-pinning)。 |
| 追蹤修補程式（例如在預先生產環境中） | 使用範圍（例如 `1.2.*` 或 `>=1.2.0 <1.3.0`） | 請參閱[標籤追蹤](#tag-tracking) |
| 追蹤次要版本（例如在 QA 環境中） | 使用範圍（例如 `1.*` 或 `>=1.0.0 <2.0.0`） | 請參閱[標籤追蹤](#tag-tracking) |
| 使用最新版本（例如在本機開發中） | 使用 `HEAD` 或 `master`（假設 `master` 是您的主分支）。 | 請參閱 [HEAD / 分支追蹤](#head--branch-tracking) |
| 使用最新版本，包括預先發行版 | 使用帶有 `-0` 後綴的星號範圍 | `*-0` 或 `>=0.0.0-0` |


### HEAD / 分支追蹤

如果指定了分支名稱或符號參考（例如 HEAD），Argo CD 將持續將即時狀態與指定分支的頂端或符號參考的已解析提交中定義的資源資訊清單進行比較。

若要重新部署應用程式，請對（至少）一個資訊清單進行變更，提交並推送到追蹤的分支/符號參考。然後，Argo CD 會偵測到此變更。

### 標籤追蹤

如果指定了標籤，則會使用指定 Git 標籤處的資訊清單來執行同步比較。與分支追蹤相比，這提供了一些優勢，因為標籤通常被認為更穩定，更新頻率較低，並且對構成標籤的內容進行了一些手動判斷。

若要重新部署應用程式，使用者使用 Git 透過將標籤重新標記到不同的提交 SHA 來變更標籤的含義。Argo CD 在執行比較/同步時會偵測到標籤的新含義。

但是，如果您使用語意化版本，您可以在您的服務修訂版中設定限制，Argo CD 會根據限制規則取得最新版本。

### 提交釘選

如果指定了 Git 提交 SHA，則應用程式會有效地釘選到指定提交中定義的資訊清單。這是最嚴格的技術，通常用於控制生產環境。

由於提交 SHA 的含義無法變更，因此變更已釘選到提交的應用程式的即時狀態的唯一方法是將應用程式中的追蹤修訂版更新為包含新資訊清單的不同提交。請注意，[參數覆寫](parameters.md)仍然可以設定在釘選到修訂版的應用程式上。
