# 元件架構

Argo CD 採用元件化架構設計。其目標是將職責分離到不同的可部署單元中，以獲得以下好處：

-   **模組化**：提供了高度的靈活性。元件之間透過介面互動。這意味著只要遵守介面合約，就可以替換給定的元件，而無需其餘系統進行調整。如果不需要特定的功能群組，也可以在沒有某些元件的情況下執行系統。
-   **單一職責**：有助於確定不同類型的功能應在何處實作，從而提升系統的內聚性。
-   **可重用性**：明確定義的介面有助於功能的可發現性，從而有利於服務的可重用性。

預設的 Argo CD 安裝由不同的元件和不同的 Kubernetes 控制器組成。控制器不被歸類為元件，因為它們具有專有的介面 (CRD)，因此缺乏模組化的特性。安裝 Argo CD 時會建立更多資源（ConfigMap、服務等），但為簡單起見，我們只涵蓋與元件化架構直接相關的資源。

## 依賴關係

下圖呈現了預設 Argo CD 安裝所使用的不同元件之間的所有依賴關係：

![元件圖](../../assets/argocd-components.png)

圖中表示了 4 個邏輯層次：

-   **UI**：這是表示層。使用者主要透過此層次的元件與 Argo CD 互動。
-   **應用程式**：支援 UI 層次元件所需的功能。
-   **核心**：主要的 Argo CD gitops 功能由核心層次的元件和 Kubernetes 控制器實作。
-   **基礎設施**：代表 Argo CD 作為其基礎設施一部分所依賴的工具。

邏輯層次也有助於使圖表更易於理解，因為依賴關係是以由上而下的關係顯示的。這意味著較高層次的元件可以依賴於任何較低層次的任何元件。然而，較低層次的元件絕不會依賴於任何較高層次的元件。

## 職責

以下是 Argo CD 元件及其主要職責的簡要說明。

### Webapp

Argo CD 附帶一個功能強大的網頁介面，允許管理部署在給定 Kubernetes 叢集中的應用程式。

### CLI

Argo CD 提供了一個 CLI，使用者可以用它來與 Argo CD API 互動。CLI 也可用於自動化和腳本編寫。

### API 伺服器

定義了 Argo CD 公開的專有 API，為 Webapp 和 CLI 功能提供支援。

### 應用程式控制器

應用程式控制器負責協調 Kubernetes 中的應用程式資源，將期望的應用程式狀態（在 Git 中提供）與即時狀態（在 Kubernetes 中）同步。應用程式控制器也負責協調專案資源。

### ApplicationSet 控制器

ApplicationSet 控制器負責協調 ApplicationSet 資源。

### Repo 伺服器

Repo 伺服器在 Argo CD 架構中扮演著重要角色，因為它負責與 Git 儲存庫互動，以產生屬於給定應用程式的所有 Kubernetes 資源的期望狀態。

### Redis

Argo CD 使用 Redis 提供一個快取層，以減少對 Kube API 以及 Git 提供者的請求。它也支援一些 UI 操作。

### Kube API

Argo CD 控制器將連接到 Kubernetes API 以執行協調迴圈。

### Git

作為一個 gitops 工具，Argo CD 要求將 Kubernetes 資源的期望狀態提供在 Git 儲存庫中。

我們在這裡使用「git」來代表一個實際的 git repo、一個 Helm repo 或一個 OCI 成品 repo。Argo CD 支援所有這些選項。

### Dex

Argo CD 依賴 Dex 來提供與外部 OIDC 提供者的身份驗證。然而，也可以使用其他工具來代替 Dex。有關更多詳細資訊，請查看[使用者管理文件](../../operator-manual/user-management/index.md)。